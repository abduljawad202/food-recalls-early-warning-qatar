# نظام الإنذار المبكر للاستدعاءات الغذائية - قطر

## نظرة عامة

نظام إنذار مبكر شامل للاستدعاءات الغذائية العالمية، يراقب المصادر الرسمية من جميع أنحاء العالم ويوفر تنبيهات فورية للمستخدمين في قطر والمنطقة العربية.

### الميزات الرئيسية

- **مراقبة مستمرة**: جلب البيانات كل 20 دقيقة من 5 مصادر عالمية
- **إشعارات فورية**: تنبيهات صوتية ومرئية عبر FCM
- **واجهة عربية**: تصميم متجاوب يدعم اللغة العربية بالكامل
- **مشاركة سهلة**: إرسال التنبيهات عبر واتساب ووسائل التواصل
- **تطبيق ويب تقدمي**: يعمل كتطبيق أصلي على الهواتف
- **أمان متقدم**: حماية شاملة للبيانات والخصوصية

## المصادر المدعومة

### 1. FDA (الولايات المتحدة)
- **API**: `https://api.fda.gov/food/enforcement.json`
- **التحديث**: كل 20 دقيقة
- **البيانات**: استدعاءات الأغذية والأدوية

### 2. Health Canada (كندا)
- **API**: `https://healthycanadians.gc.ca/recall-alert-rappel-avis/api/recent/en`
- **التحديث**: كل 20 دقيقة
- **البيانات**: تنبيهات الصحة والسلامة

### 3. SFDA (السعودية)
- **المصدر**: `https://www.sfda.gov.sa/`
- **التحديث**: كل 20 دقيقة
- **البيانات**: استدعاءات الهيئة العامة للغذاء والدواء

### 4. FSANZ (أستراليا/نيوزيلندا)
- **API**: `https://www.foodstandards.gov.au/api/foodrecalls`
- **التحديث**: كل 20 دقيقة
- **البيانات**: استدعاءات معايير الغذاء

### 5. RASFF (الاتحاد الأوروبي)
- **المصدر**: `https://webgate.ec.europa.eu/rasff-window/`
- **التحديث**: كل 20 دقيقة
- **البيانات**: نظام الإنذار السريع للأغذية والأعلاف

## البنية التقنية

### Frontend (الواجهة الأمامية)
- **HTML5**: هيكل الصفحة مع دعم PWA
- **CSS3**: تصميم متجاوب مع متغيرات CSS
- **JavaScript**: وظائف تفاعلية وإدارة البيانات
- **Firebase SDK**: تكامل مع خدمات Firebase

### Backend (الخادم الخلفي)
- **Cloud Functions**: Node.js 18 مع Express
- **Firestore**: قاعدة بيانات NoSQL للتخزين
- **Cloud Scheduler**: تشغيل المهام المجدولة
- **Cloud Messaging**: إرسال الإشعارات

### البنية السحابية
- **Firebase Hosting**: استضافة الواجهة الأمامية
- **Google Cloud**: البنية التحتية السحابية
- **CDN**: شبكة توزيع المحتوى العالمية
- **SSL/TLS**: تشفير جميع الاتصالات

## هيكل قاعدة البيانات

### Collection: `recalls`
```javascript
{
  id: "string",                    // معرف فريد
  title: "string",                 // عنوان الاستدعاء
  brand: "string",                 // العلامة التجارية
  lot: "string",                   // رقم الدفعة
  reason: "string",                // سبب الاستدعاء
  date: "timestamp",               // تاريخ الاستدعاء
  scope: "international|national", // النطاق
  country: "string",               // الدولة
  agency: "string",                // الجهة المصدرة
  source_url: "string",            // رابط المصدر
  image: "string|null",            // صورة المنتج
  qa_possible: "boolean",          // خطر محتمل
  created_at: "timestamp",         // تاريخ الإنشاء
  updated_at: "timestamp"          // تاريخ التحديث
}
```

### Collection: `subscribers`
```javascript
{
  token: "string",                 // FCM Token
  subscribed_at: "timestamp",      // تاريخ الاشتراك
  active: "boolean",               // حالة الاشتراك
  user_agent: "string",            // معلومات المتصفح
  last_seen: "timestamp"           // آخر نشاط
}
```

### Collection: `notification_stats`
```javascript
{
  recall_id: "string",             // معرف الاستدعاء
  sent_at: "timestamp",            // وقت الإرسال
  subscribers_count: "number",     // عدد المشتركين
  success_count: "number",         // عدد الإرسال الناجح
  failure_count: "number"          // عدد الإرسال الفاشل
}
```

## Cloud Functions

### 1. `recalls` (HTTP Function)
- **الغرض**: جلب وعرض بيانات الاستدعاءات
- **الطرق**: GET, POST
- **GET**: إرجاع البيانات المحفوظة
- **POST**: تحديث البيانات من المصادر

### 2. `scheduledRecallsUpdate` (Scheduled Function)
- **الغرض**: تحديث البيانات تلقائياً
- **الجدولة**: كل 20 دقيقة
- **المهام**: جلب من جميع المصادر وحفظ الجديد

### 3. `sendNotificationOnNewRecall` (Firestore Trigger)
- **الغرض**: إرسال إشعارات للاستدعاءات الجديدة
- **المحفز**: إضافة document جديد في `recalls`
- **الوظائف**: إرسال FCM، تسجيل الإحصائيات

### 4. `manageTopicSubscriptions` (HTTP Function)
- **الغرض**: إدارة اشتراكات المواضيع
- **الطرق**: POST
- **الوظائف**: اشتراك/إلغاء اشتراك في المواضيع

### 5. `sendTestNotification` (HTTP Function)
- **الغرض**: إرسال إشعار تجريبي
- **الطرق**: POST
- **الاستخدام**: اختبار نظام الإشعارات

## الأمان والحماية

### قواعد Firestore
- **القراءة**: مفتوحة للجميع
- **الكتابة**: مقيدة بالـ Functions المعتمدة
- **التحقق**: من صحة البيانات قبل الحفظ
- **المراقبة**: تسجيل جميع العمليات

### حماية API
- **CORS**: مقيد بالنطاقات المعتمدة
- **Rate Limiting**: حد أقصى للطلبات
- **Input Validation**: التحقق من صحة البيانات
- **Error Handling**: معالجة آمنة للأخطاء

### الخصوصية
- **تشفير**: جميع البيانات مشفرة
- **عدم تتبع**: لا نجمع بيانات شخصية
- **الاحتفاظ**: حذف البيانات القديمة تلقائياً
- **الشفافية**: سياسة خصوصية واضحة

## الإشعارات والتنبيهات

### أنواع الإشعارات
1. **إشعارات عامة**: لجميع الاستدعاءات الجديدة
2. **إشعارات عاجلة**: للاستدعاءات عالية الخطورة
3. **إشعارات جغرافية**: حسب الدولة أو المنطقة
4. **إشعارات تجريبية**: لاختبار النظام

### قنوات التنبيه
- **FCM Push Notifications**: إشعارات المتصفح
- **In-App Notifications**: تنبيهات داخل التطبيق
- **Audio Alerts**: تنبيهات صوتية
- **Visual Alerts**: تأثيرات بصرية

### مواضيع FCM
- `all-users`: جميع المستخدمين
- `urgent-recalls`: الاستدعاءات العاجلة
- `country-[name]`: حسب الدولة
- `security-alerts`: تنبيهات أمنية

## واجهة المستخدم

### التصميم
- **اللغة**: العربية كلغة أساسية
- **الاتجاه**: من اليمين إلى اليسار (RTL)
- **الألوان**: أحمر للخطر، أخضر للأمان
- **الخطوط**: Cairo للنصوص العربية

### المكونات الرئيسية
1. **الرأس**: الشعار وأدوات التحكم
2. **الإحصائيات**: ملخص سريع للبيانات
3. **الفلاتر**: تصفية البيانات حسب المعايير
4. **البطاقات**: عرض تفاصيل الاستدعاءات
5. **النوافذ المنبثقة**: تفاصيل إضافية
6. **التذييل**: معلومات الاتصال والمصادر

### الميزات التفاعلية
- **البحث**: في جميع الحقول
- **الفلترة**: حسب الدولة، الجهة، النطاق
- **الترتيب**: حسب التاريخ، الأهمية
- **المشاركة**: واتساب، تويتر، فيسبوك
- **التصدير**: CSV, JSON
- **الطباعة**: تقارير مخصصة

## التطبيق التقدمي (PWA)

### الميزات
- **التثبيت**: يمكن تثبيته كتطبيق
- **العمل بدون إنترنت**: تخزين مؤقت ذكي
- **التحديث التلقائي**: Service Worker
- **الإشعارات**: حتى عند إغلاق التطبيق

### ملفات PWA
- `manifest.json`: معلومات التطبيق
- `firebase-messaging-sw.js`: Service Worker
- أيقونات متعددة الأحجام
- صور للمتاجر

## الأداء والتحسين

### تحسينات الأداء
- **تحميل تدريجي**: البيانات تحمل حسب الحاجة
- **ضغط الصور**: تحسين أحجام الصور
- **تخزين مؤقت**: Cache للبيانات المتكررة
- **CDN**: توزيع المحتوى عالمياً

### مقاييس الأداء
- **First Contentful Paint**: < 2 ثانية
- **Largest Contentful Paint**: < 3 ثوان
- **Time to Interactive**: < 4 ثوان
- **Cumulative Layout Shift**: < 0.1

## النشر والصيانة

### بيئات النشر
- **التطوير**: Firebase Emulators
- **الاختبار**: Firebase Staging
- **الإنتاج**: Firebase Production

### عمليات النشر
```bash
# نشر كامل
firebase deploy

# نشر Functions فقط
firebase deploy --only functions

# نشر Hosting فقط
firebase deploy --only hosting
```

### النسخ الاحتياطي
- **تلقائي**: كل يوم في الساعة 2 صباحاً
- **يدوي**: عند الحاجة
- **الاحتفاظ**: 30 يوم
- **الاستعادة**: خلال ساعات

## المراقبة والتحليل

### مراقبة النظام
- **Firebase Performance**: أداء التطبيق
- **Cloud Monitoring**: صحة الخدمات
- **Error Reporting**: تتبع الأخطاء
- **Cloud Logging**: سجلات مفصلة

### التحليلات
- **Google Analytics**: إحصائيات الزوار
- **Firebase Analytics**: تفاعل المستخدمين
- **Custom Metrics**: مقاييس مخصصة
- **Real-time Data**: بيانات فورية

## التطوير المستقبلي

### الميزات المخططة
1. **دعم لغات إضافية**: الإنجليزية، الفرنسية
2. **تطبيق موبايل**: iOS و Android أصلي
3. **ذكاء اصطناعي**: تصنيف تلقائي للمخاطر
4. **تكامل API**: للجهات الحكومية
5. **تقارير متقدمة**: تحليلات وإحصائيات

### التحسينات التقنية
1. **GraphQL**: API أكثر مرونة
2. **Microservices**: هيكلة أفضل للخدمات
3. **Machine Learning**: تحليل ذكي للبيانات
4. **Blockchain**: تتبع آمن للبيانات

## الدعم والصيانة

### فريق الدعم
- **المطور الرئيسي**: إدارة التطوير
- **مهندس DevOps**: إدارة البنية التحتية
- **مختص الأمان**: مراجعة الأمان
- **مدير المنتج**: التخطيط الاستراتيجي

### جهات الاتصال
- **الدعم التقني**: support@foodrecalls-qatar.com
- **الطوارئ**: emergency@foodrecalls-qatar.com
- **الشراكات**: partnerships@foodrecalls-qatar.com

### ساعات العمل
- **الدعم العادي**: 8 صباحاً - 6 مساءً (GMT+3)
- **الطوارئ**: 24/7
- **الصيانة**: الجمعة 2-4 صباحاً

## الامتثال والمعايير

### المعايير المتبعة
- **ISO 27001**: أمان المعلومات
- **GDPR**: حماية البيانات الأوروبية
- **CCPA**: خصوصية المستهلك الكاليفورني
- **SOC 2**: ضوابط الأمان

### الشهادات
- **Firebase**: معتمد من Google Cloud
- **SSL/TLS**: شهادة أمان صالحة
- **PWA**: متوافق مع معايير الويب
- **Accessibility**: WCAG 2.1 AA

## الترخيص والحقوق

### الترخيص
- **النوع**: MIT License
- **الاستخدام**: مجاني للاستخدام الشخصي والتجاري
- **التعديل**: مسموح مع الإشارة للمصدر
- **التوزيع**: مسموح

### حقوق الطبع
- **الكود**: © 2024 Food Safety Qatar
- **التصميم**: © 2024 Food Safety Qatar
- **البيانات**: حقوق المصادر الأصلية
- **الشعار**: © 2024 Food Safety Qatar

---

*تم إنشاء هذا التوثيق في ديسمبر 2024. للحصول على أحدث المعلومات، يرجى زيارة الموقع الرسمي.*
