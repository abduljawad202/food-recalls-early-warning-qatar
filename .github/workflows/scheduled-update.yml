name: Scheduled Food Recalls Update

on:
  schedule:
    # ØªØ´ØºÙŠÙ„ ÙƒÙ„ 10 Ø¯Ù‚Ø§Ø¦Ù‚ (Ù…Ø¬Ø§Ù†ÙŠ Ø¶Ù…Ù† Ø­Ø¯ÙˆØ¯ GitHub Actions)
    - cron: '*/10 * * * *'
  workflow_dispatch:
    # Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙŠØ¯ÙˆÙŠ

jobs:
  update-recalls:
    runs-on: ubuntu-latest
    
    steps:
    - name: Trigger Firebase Function Update
      run: |
        echo "ğŸ”„ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¬Ø¯ÙˆÙ„ Ù„Ù„Ø§Ø³ØªØ¯Ø¹Ø§Ø¡Ø§Øª Ø§Ù„ØºØ°Ø§Ø¦ÙŠØ©..."
        
        # Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Firebase Function Ù„Ù„ØªØ­Ø¯ÙŠØ«
        response=$(curl -s -w "%{http_code}" \
          -X POST \
          -H "Content-Type: application/json" \
          -H "User-Agent: GitHub-Actions-Scheduler/1.0" \
          --max-time 300 \
          "https://us-central1-food-recalls-qatar.cloudfunctions.net/scheduledUpdate")
        
        http_code="${response: -3}"
        response_body="${response%???}"
        
        echo "ğŸ“¡ HTTP Status: $http_code"
        echo "ğŸ“„ Response: $response_body"
        
        if [ "$http_code" -eq 200 ]; then
          echo "âœ… ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­!"
        else
          echo "âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ« - HTTP $http_code"
          exit 1
        fi
        
    - name: Log Update Status
      run: |
        echo "â° ÙˆÙ‚Øª Ø§Ù„ØªØ­Ø¯ÙŠØ«: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
        echo "ğŸŒ Ù…ØµØ§Ø¯Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: FDA, CFIA/Health Canada, SFDA, FSANZ"
        echo "ğŸ¯ Ø§Ù„Ù‡Ø¯Ù: Ù…Ø±Ø§Ù‚Ø¨Ø© Ù…Ø³ØªÙ…Ø±Ø© Ù„Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„ØºØ°Ø§Ø¦ÙŠØ© Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©"
        echo "ğŸ‡¶ğŸ‡¦ Ø§Ù„ØªØ±ÙƒÙŠØ²: Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù…Ø³ØªÙ‡Ù„ÙƒÙŠÙ† ÙÙŠ Ø¯ÙˆÙ„Ø© Ù‚Ø·Ø±"
        
    - name: Health Check
      run: |
        echo "ğŸ¥ ÙØ­Øµ ØµØ­Ø© Ø§Ù„Ù†Ø¸Ø§Ù…..."
        
        # ÙØ­Øµ ØªÙˆÙØ± Firebase Functions
        health_response=$(curl -s -w "%{http_code}" \
          -H "User-Agent: GitHub-Actions-HealthCheck/1.0" \
          --max-time 30 \
          "https://us-central1-food-recalls-qatar.cloudfunctions.net/recalls")
        
        health_code="${health_response: -3}"
        
        if [ "$health_code" -eq 200 ]; then
          echo "âœ… Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ø·Ø¨ÙŠØ¹ÙŠ"
        else
          echo "âš ï¸ ØªØ­Ø°ÙŠØ±: Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù†Ø¸Ø§Ù… - HTTP $health_code"
        fi
        
        echo "ğŸ“Š ØªÙ… Ø¥ÙƒÙ…Ø§Ù„ ÙØ­Øµ Ø§Ù„ØµØ­Ø©"

env:
  TZ: Asia/Qatar
